<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <title>NOTES</title>
  <style>
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style>
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<h1 id="api-2">API-2</h1>
<p><em>ATTENTION:</em> go to mongoose website and see the starter code they have to hopefully fix the issue of soon-to-be depricated mongoose (see terminal error output bellow â€“ not error, but warning, really). From mongoose website:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">const</span> mongoose <span class="op">=</span> <span class="at">require</span>(<span class="st">&#39;mongoose&#39;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="va">mongoose</span>.<span class="at">connect</span>(<span class="st">&#39;mongodb://localhost:27017/test&#39;</span><span class="op">,</span> <span class="op">{</span><span class="dt">useNewUrlParser</span><span class="op">:</span> <span class="kw">true</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-3" title="3"></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">const</span> Cat <span class="op">=</span> <span class="va">mongoose</span>.<span class="at">model</span>(<span class="st">&#39;Cat&#39;</span><span class="op">,</span> <span class="op">{</span> <span class="dt">name</span><span class="op">:</span> String <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">const</span> kitty <span class="op">=</span> <span class="kw">new</span> <span class="at">Cat</span>(<span class="op">{</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&#39;Zildjian&#39;</span> <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb1-7" title="7"><span class="va">kitty</span>.<span class="at">save</span>().<span class="at">then</span>(() <span class="kw">=&gt;</span> <span class="va">console</span>.<span class="at">log</span>(<span class="st">&#39;meow&#39;</span>))<span class="op">;</span></a></code></pre></div>
<p>Run <code>npm run readme</code> to convert readme to HTML and open in browser. Script defined in <code>package.json</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb2-1" title="1"><span class="er">&quot;scripts&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">    <span class="dt">&quot;readme&quot;</span><span class="fu">:</span> <span class="st">&quot;pandoc README.md -s -o README.html &amp;&amp; open README.html&quot;</span></a>
<a class="sourceLine" id="cb2-3" title="3">  <span class="fu">}</span></a></code></pre></div>
<p>Interesting point: GET request to <code>localhost:3000/README.html</code> will return an error, so does not function as webserver.</p>
<p>Following tutorial:</p>
<ul>
<li><a href="https://academind.com/learn/node-js/building-a-restful-api-with/adding-more-routes-to-the-api/">academind.com</a></li>
<li><a href="https://www.youtube.com/watch?v=UVAMha41dwo&amp;feature=emb_logo">academind on youtube</a></li>
</ul>
<h2 id="how-to-deploy-to-heroku">How to deploy to heroku:</h2>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb3-1" title="1"><span class="fu">git</span> add -A</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="fu">git</span> commit -m <span class="st">&quot;description of changes made&quot;</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="ex">heroku</span> login</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co"># IF NEVER BEFORE DEPLOYED: heroku create</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="fu">git</span> push heroku master</a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co"># DONE -- now go test with postman</span></a></code></pre></div>
<p>Or command <code>npm run deploy</code> (script defined in <code>package.json</code>):</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb4-1" title="1"><span class="er">&quot;scripts&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">    <span class="dt">&quot;deploy&quot;</span><span class="fu">:</span> <span class="st">&quot;git add -A &amp;&amp; git commit &amp;&amp; heroku login &amp;&amp; git push heroku master&quot;</span></a>
<a class="sourceLine" id="cb4-3" title="3">  <span class="fu">}</span></a></code></pre></div>
<h2 id="how-to-localhost">How to localhost:</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb5-1" title="1"><span class="ex">node</span> server.js</a>
<a class="sourceLine" id="cb5-2" title="2"><span class="co"># now go to localhost:3000</span></a></code></pre></div>
<h2 id="how-the-nodemon-thing-works">How the nodemon thing works:</h2>
<p>Nodemon: server restarts every time a file changes.</p>
<p>Install by: <code>npm install --save-dev nodemon</code></p>
<p>Nodemon is not installed globally. Only works when run from this project directory. Normally, would use <code>nodemon server.js</code> to start server. Better way already implemented: add start script to <code>package.json</code> that gets run when you command <code>npm start</code> (NOT <code>npm run start</code>). <code>package.json</code> entry:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb6-1" title="1"><span class="er">&quot;scripts&quot;:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">    <span class="dt">&quot;start&quot;</span><span class="fu">:</span> <span class="st">&quot;echo </span><span class="ch">\&quot;</span><span class="st">Starting nodemon server...</span><span class="ch">\&quot;</span><span class="st"> &amp;&amp; nodemon server.js&quot;</span></a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="fu">}</span></a></code></pre></div>
<h2 id="morgan-for-logging">morgan for logging</h2>
<p>installed with: <code>npm install --save morgan</code></p>
<h2 id="notes-on-body-parsing-cors-vid">Notes on body parsing &amp; CORS vid</h2>
<p>full vid title: Parsing the Body &amp; Handling CORS | Creating a REST API with Node.js</p>
<ul>
<li>add package: <code>npm install --save body-parser</code></li>
</ul>
<h3 id="json-body-parser-post-test">JSON body parser POST test:</h3>
<p>request: <code>POST localhost:3000/products</code> with body:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb7-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;shoes&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb7-3" title="3">    <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="st">&quot;10.00&quot;</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="fu">}</span></a></code></pre></div>
<p>note: for valid json, everything must be in quotation marks</p>
<p>response:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb8-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">    <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Handling POST requests to /products&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-3" title="3">    <span class="dt">&quot;createdProduct&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb8-4" title="4">        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;shoes&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb8-5" title="5">        <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="st">&quot;10.00&quot;</span></a>
<a class="sourceLine" id="cb8-6" title="6">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb8-7" title="7"><span class="fu">}</span></a></code></pre></div>
<p>orders also works as expected</p>
<h2 id="notes-on-first-database-vid">Notes on first database vid</h2>
<p>will use mongoose instead of official client: <code>npm install --save mongoose</code></p>
<p>watch out for this shit with mongoose/mongodb atlas:</p>
<pre><code>(node:22727) DeprecationWarning: current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect.
(node:22727) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.</code></pre>
<p>and</p>
<pre><code>WARNING: The `useMongoClient` option is no longer necessary in mongoose 5.x, please remove it.
    at handleUseMongoClient (/Users/nikitazdvijkov/Documents/vm-shared/GITHUB/misc-experiments/SUMMER-INTERNSHIP-SPRINT-FEB-2020/API-2/node_modules/mongoose/lib/connection.js:840:17)
    at NativeConnection.Connection.openUri (/Users/nikitazdvijkov/Documents/vm-shared/GITHUB/misc-experiments/SUMMER-INTERNSHIP-SPRINT-FEB-2020/API-2/node_modules/mongoose/lib/connection.js:635:7)
    at Mongoose.connect (/Users/nikitazdvijkov/Documents/vm-shared/GITHUB/misc-experiments/SUMMER-INTERNSHIP-SPRINT-FEB-2020/API-2/node_modules/mongoose/lib/index.js:332:15)
    at Object.&lt;anonymous&gt; (/Users/nikitazdvijkov/Documents/vm-shared/GITHUB/misc-experiments/SUMMER-INTERNSHIP-SPRINT-FEB-2020/API-2/app.js:7:10)
    at Module._compile (internal/modules/cjs/loader.js:1139:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1159:10)
    at Module.load (internal/modules/cjs/loader.js:988:32)
    at Function.Module._load (internal/modules/cjs/loader.js:896:14)
    at Module.require (internal/modules/cjs/loader.js:1028:19)
    at require (internal/modules/cjs/helpers.js:72:18)
    at Object.&lt;anonymous&gt; (/Users/nikitazdvijkov/Documents/vm-shared/GITHUB/misc-experiments/SUMMER-INTERNSHIP-SPRINT-FEB-2020/API-2/server.js:2:13)
    at Module._compile (internal/modules/cjs/loader.js:1139:30)
    at Object.Module._extensions..js (internal/modules/cjs/loader.js:1159:10)
    at Module.load (internal/modules/cjs/loader.js:988:32)
    at Function.Module._load (internal/modules/cjs/loader.js:896:14)
    at Function.executeUserEntryPoint [as runMain] (internal/modules/run_main.js:71:12)
(node:22858) DeprecationWarning: current URL string parser is deprecated, and will be removed in a future version. To use the new parser, pass option { useNewUrlParser: true } to MongoClient.connect.
(node:22858) DeprecationWarning: current Server Discovery and Monitoring engine is deprecated, and will be removed in a future version. To use the new Server Discover and Monitoring engine, pass option { useUnifiedTopology: true } to the MongoClient constructor.</code></pre>
<h3 id="how-to-env-variable-with-nodemon">how to env variable with nodemon</h3>
<p>create <code>nodemon.json</code> file with contents:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb11-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">    <span class="dt">&quot;env&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb11-3" title="3">        <span class="dt">&quot;MONGO_ATLAS_PW&quot;</span><span class="fu">:</span> <span class="st">&quot;blahablahldfadfadf&quot;</span></a>
<a class="sourceLine" id="cb11-4" title="4">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="fu">}</span></a></code></pre></div>
<h3 id="test-database-and-product-id-stuff">test database and product id stuff</h3>
<p><code>POST</code> request to <code>localhost/3000/products</code> with body:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb12-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;shoes&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb12-3" title="3">    <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="st">&quot;19.99&quot;</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="fu">}</span></a></code></pre></div>
<p>response:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb13-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb13-2" title="2">    <span class="dt">&quot;message&quot;</span><span class="fu">:</span> <span class="st">&quot;Handling POST requests to /products&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb13-3" title="3">    <span class="dt">&quot;createdProduct&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb13-4" title="4">        <span class="dt">&quot;_id&quot;</span><span class="fu">:</span> <span class="st">&quot;5e407b065199dc5b669851de&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb13-5" title="5">        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;shoes&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb13-6" title="6">        <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fl">19.99</span></a>
<a class="sourceLine" id="cb13-7" title="7">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="fu">}</span></a></code></pre></div>
<p>for cluster, go to COLLECTIONS tab to see the data!</p>
<h3 id="getting-from-database">GETTING from database:</h3>
<p>(postman) <code>GET</code> request to <code>localhost:3000/products/5e407d6d2fb9490017b07f75</code> with NO body. response:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb14-1" title="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">    <span class="dt">&quot;_id&quot;</span><span class="fu">:</span> <span class="st">&quot;5e407d6d2fb9490017b07f75&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb14-3" title="3">    <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;shirt&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb14-4" title="4">    <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb14-5" title="5">    <span class="dt">&quot;__v&quot;</span><span class="fu">:</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb14-6" title="6"><span class="fu">}</span></a></code></pre></div>
<p>note difference between invalid ID and an ID that does not exist:</p>
<pre><code>valid:   5e407d6d2fb9490017b07f75
invalid: 5e407d6d2fb9490017b07f7  (bc string too short)
DNE:     5e407d6d2fb9490017b07f76 (bc final character differs)</code></pre>
<h3 id="make-general-get-request-to-products">make general GET request to /products:</h3>
<p>response (note: square brackets make it an array):</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb16-1" title="1"><span class="ot">[</span></a>
<a class="sourceLine" id="cb16-2" title="2">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb16-3" title="3">        <span class="dt">&quot;_id&quot;</span><span class="fu">:</span> <span class="st">&quot;5e407b065199dc5b669851de&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb16-4" title="4">        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;shoes&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb16-5" title="5">        <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="fl">19.99</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb16-6" title="6">        <span class="dt">&quot;__v&quot;</span><span class="fu">:</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb16-7" title="7">    <span class="fu">}</span><span class="ot">,</span></a>
<a class="sourceLine" id="cb16-8" title="8">    <span class="fu">{</span></a>
<a class="sourceLine" id="cb16-9" title="9">        <span class="dt">&quot;_id&quot;</span><span class="fu">:</span> <span class="st">&quot;5e407d6d2fb9490017b07f75&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb16-10" title="10">        <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;shirt&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb16-11" title="11">        <span class="dt">&quot;price&quot;</span><span class="fu">:</span> <span class="dv">5</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb16-12" title="12">        <span class="dt">&quot;__v&quot;</span><span class="fu">:</span> <span class="dv">0</span></a>
<a class="sourceLine" id="cb16-13" title="13">    <span class="fu">}</span></a>
<a class="sourceLine" id="cb16-14" title="14"><span class="ot">]</span></a></code></pre></div>
<h2 id="misc">MISC</h2>
<ul>
<li>In <code>package.json</code>, renamed script from <code>start</code> to <code>dev-start</code> to avoid heroku errors. Run <code>npm run dev-start</code>. Re-added morgan logging.</li>
<li>figure out how to connect git to heroku so heroku auto-deploys on update like netlify</li>
<li>running <code>heroku local web</code> deploys app to <code>localhost:5000</code></li>
</ul>
<p>removed this chunk of code from tips.js to de-privelege:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1"><span class="va">router</span>.<span class="at">patch</span>(<span class="st">&#39;/:tipId&#39;</span><span class="op">,</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">    <span class="kw">let</span> patchServerSideTimestamp <span class="op">=</span> <span class="kw">new</span> <span class="at">Date</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb17-3" title="3">    <span class="kw">const</span> id <span class="op">=</span> <span class="va">req</span>.<span class="va">params</span>.<span class="at">tipId</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-4" title="4">    <span class="va">Tip</span>.<span class="at">update</span>(</a>
<a class="sourceLine" id="cb17-5" title="5">        <span class="op">{</span> <span class="dt">_id</span><span class="op">:</span> id <span class="op">},</span> </a>
<a class="sourceLine" id="cb17-6" title="6">        <span class="op">{</span> </a>
<a class="sourceLine" id="cb17-7" title="7">            <span class="dt">$set</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-8" title="8">                <span class="dt">alias</span><span class="op">:</span> <span class="va">req</span>.<span class="va">body</span>.<span class="at">newAlias</span><span class="op">,</span></a>
<a class="sourceLine" id="cb17-9" title="9">                <span class="dt">tipContent</span><span class="op">:</span> <span class="va">req</span>.<span class="va">body</span>.<span class="at">newTipContent</span><span class="op">,</span></a>
<a class="sourceLine" id="cb17-10" title="10">                <span class="dt">tags</span><span class="op">:</span> <span class="va">req</span>.<span class="va">body</span>.<span class="at">newTags</span><span class="op">,</span></a>
<a class="sourceLine" id="cb17-11" title="11">                <span class="dt">timestamp</span><span class="op">:</span> patchServerSideTimestamp<span class="op">,</span></a>
<a class="sourceLine" id="cb17-12" title="12">                <span class="dt">isLive</span><span class="op">:</span> <span class="va">req</span>.<span class="va">body</span>.<span class="at">newIsLive</span></a>
<a class="sourceLine" id="cb17-13" title="13">            <span class="op">}</span></a>
<a class="sourceLine" id="cb17-14" title="14">        <span class="op">}</span>)</a>
<a class="sourceLine" id="cb17-15" title="15">            .<span class="at">exec</span>()</a>
<a class="sourceLine" id="cb17-16" title="16">            .<span class="at">then</span>(result <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-17" title="17">                <span class="va">console</span>.<span class="at">log</span>(res)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-18" title="18">                <span class="va">res</span>.<span class="at">status</span>(<span class="dv">200</span>).<span class="at">json</span>(result)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-19" title="19">            <span class="op">}</span>)</a>
<a class="sourceLine" id="cb17-20" title="20">            .<span class="at">catch</span>(err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-21" title="21">                <span class="va">console</span>.<span class="at">log</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-22" title="22">                <span class="va">res</span>.<span class="at">status</span>(<span class="dv">500</span>).<span class="at">json</span>(<span class="op">{</span><span class="dt">error</span><span class="op">:</span> err<span class="op">}</span>)</a>
<a class="sourceLine" id="cb17-23" title="23">            <span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-24" title="24">    <span class="co">// ops stands for operations</span></a>
<a class="sourceLine" id="cb17-25" title="25">    <span class="co">// see alternative, that goes through and checks if the ops need changing</span></a>
<a class="sourceLine" id="cb17-26" title="26">    <span class="co">// and only changes the ones that do instead of all in a patch req</span></a>
<a class="sourceLine" id="cb17-27" title="27">    <span class="co">/*</span></a>
<a class="sourceLine" id="cb17-28" title="28"><span class="co">    ahhh fuck it i dont need this</span></a>
<a class="sourceLine" id="cb17-29" title="29"><span class="co">    go to timestamp </span></a>
<a class="sourceLine" id="cb17-30" title="30"><span class="co">    31:30</span></a>
<a class="sourceLine" id="cb17-31" title="31"><span class="co">    on video title </span></a>
<a class="sourceLine" id="cb17-32" title="32"><span class="co">    MongoDB and Mongoose | Creating a REST API with Node.js</span></a>
<a class="sourceLine" id="cb17-33" title="33"><span class="co">    video url</span></a>
<a class="sourceLine" id="cb17-34" title="34"><span class="co">    https://youtu.be/WDrU305J1yw</span></a>
<a class="sourceLine" id="cb17-35" title="35"><span class="co">    to get the code</span></a>
<a class="sourceLine" id="cb17-36" title="36"><span class="co">    Product.update(</span></a>
<a class="sourceLine" id="cb17-37" title="37"><span class="co">        { _id: id }, </span></a>
<a class="sourceLine" id="cb17-38" title="38"><span class="co">        { </span></a>
<a class="sourceLine" id="cb17-39" title="39"><span class="co">            $set: updateOps</span></a>
<a class="sourceLine" id="cb17-40" title="40"><span class="co">        });</span></a>
<a class="sourceLine" id="cb17-41" title="41"><span class="co">    */</span></a>
<a class="sourceLine" id="cb17-42" title="42"><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-43" title="43"><span class="va">router</span>.<span class="at">delete</span>(<span class="st">&#39;/:tipId&#39;</span><span class="op">,</span> (req<span class="op">,</span> res<span class="op">,</span> next) <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-44" title="44">    id <span class="op">=</span> <span class="va">req</span>.<span class="va">params</span>.<span class="at">tipId</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-45" title="45">    <span class="co">// dont have to pass whole object to remove, just filter criteria -- means remove any object in db that fits criteria</span></a>
<a class="sourceLine" id="cb17-46" title="46">    <span class="va">Tip</span>.<span class="at">remove</span>(<span class="op">{</span><span class="dt">_id</span><span class="op">:</span> id<span class="op">}</span>)</a>
<a class="sourceLine" id="cb17-47" title="47">        .<span class="at">exec</span>()</a>
<a class="sourceLine" id="cb17-48" title="48">        .<span class="at">then</span>(result <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-49" title="49">            <span class="va">res</span>.<span class="at">status</span>(<span class="dv">200</span>).<span class="at">json</span>(result)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-50" title="50">        <span class="op">}</span>)</a>
<a class="sourceLine" id="cb17-51" title="51">        .<span class="at">catch</span>(err <span class="kw">=&gt;</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb17-52" title="52">            <span class="va">console</span>.<span class="at">log</span>(err)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-53" title="53">            <span class="va">res</span>.<span class="at">status</span>(<span class="dv">500</span>).<span class="at">json</span>(<span class="op">{</span><span class="dt">error</span><span class="op">:</span> err<span class="op">}</span>)<span class="op">;</span> <span class="co">// error object we got from mongoose </span></a>
<a class="sourceLine" id="cb17-54" title="54">        <span class="op">}</span>)<span class="op">;</span> </a>
<a class="sourceLine" id="cb17-55" title="55"><span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
</body>
</html>
